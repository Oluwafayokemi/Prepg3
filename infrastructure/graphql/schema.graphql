# infrastructure/graphql/schema-final-comprehensive.graphql

# ==========================================
# INVESTOR TYPES
# ==========================================

type Investor {
  id: ID!

  # Basic Information
  email: String!
  firstName: String!
  lastName: String!
  middleName: String
  title: String
  dateOfBirth: AWSDate
  nationalInsuranceNumber: String # Encrypted

  # Contact Information
  phone: String
  mobilePhone: String
  workPhone: String
  preferredContactMethod: ContactMethod

  # Address Information
  address: Address
  mailingAddress: Address
  previousAddresses: [Address!] # For AML compliance (last 3 years)

  # Employment Information
  employmentStatus: EmploymentStatus
  occupation: String
  employer: String
  annualIncome: IncomeRange
  sourceOfFunds: SourceOfFunds
  sourceOfWealth: String

  # Bank Account Details
  bankAccounts: [BankAccount!]
  primaryBankAccountId: ID

  # Investment Information
  investorType: InvestorType!
  investorCategory: InvestorCategory
  riskTolerance: RiskTolerance
  investmentObjectives: [String!]
  investmentExperience: InvestmentExperience
  totalInvested: Float!
  portfolioValue: Float!
  totalROI: Float!

  # Next of Kin / Emergency Contact
  nextOfKin: NextOfKin
  emergencyContact: EmergencyContact

  # Tax Information
  taxResidency: String
  taxIdentificationNumber: String # Encrypted
  isFATCAReportable: Boolean

  # Identity Verification (KYC)
  identityVerification: IdentityVerification
  proofOfAddress: ProofOfAddress
  kycStatus: KYCStatus!
  kycVerifiedDate: AWSDateTime
  kycExpiryDate: AWSDateTime
  kycRejectionReason: String
  
  # AML & Compliance
  amlCheckStatus: AMLStatus!
  amlCheckDate: AWSDateTime
  amlRiskLevel: RiskLevel

  # Legal & Compliance
  isPEP: Boolean
  pepDetails: String
  pepPosition: String
  pepCountry: String
  sanctionsCheckStatus: SanctionsStatus
  sanctionsCheckDate: AWSDateTime

  # Preferences & Settings
  marketingConsent: Boolean!
  dataProcessingConsent: Boolean!
  termsAcceptedDate: AWSDateTime
  privacyPolicyAcceptedDate: AWSDateTime
  communicationPreferences: CommunicationPreferences

  # Account Status
  accountStatus: AccountStatus!
  accountTier: AccountTier
  verificationLevel: VerificationLevel!
  emailVerified: Boolean!
  phoneVerified: Boolean
  emailVerificationToken: String # Internal use only

  # Relationships
  investments: [Investment!]
  transactions: [Transaction!]
  documents: [Document!]
  notifications: [Notification!]
  amlAlerts: [AMLAlert!]

  # Metadata
  referralSource: String
  referredBy: ID
  notes: String # Admin only
  lastReviewDate: AWSDateTime
  nextReviewDate: AWSDateTime
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  lastLoginAt: AWSDateTime
}

# ==========================================
# NESTED TYPES
# ==========================================

type Address {
  addressLine1: String!
  addressLine2: String
  city: String!
  county: String
  postcode: String!
  country: String!
  residencySince: AWSDate
  isCurrentAddress: Boolean!
}

type BankAccount {
  id: ID!
  accountName: String!
  bankName: String!
  accountNumber: String! # Last 4 digits only (encrypted in DB)
  sortCode: String!
  iban: String
  swiftCode: String
  isPrimary: Boolean!
  isVerified: Boolean!
  verifiedDate: AWSDateTime
  verificationMethod: String # Micro-deposits, Manual, etc.
  currency: String!
  accountType: BankAccountType!
  createdAt: AWSDateTime!
}

type NextOfKin {
  firstName: String!
  lastName: String!
  relationship: String!
  phone: String!
  email: String
  address: Address
  dateOfBirth: AWSDate
}

type EmergencyContact {
  firstName: String!
  lastName: String!
  relationship: String!
  phone: String!
  alternativePhone: String
  email: String
}

type IdentityVerification {
  documentType: IDDocumentType!
  documentNumber: String! # Encrypted
  issuingCountry: String!
  issueDate: AWSDate
  expiryDate: AWSDate
  documentImages: [String!]
  verificationMethod: VerificationMethod
  verificationProvider: String # Onfido, Jumio, Manual, etc.
  verifiedBy: String
  verifiedDate: AWSDateTime
}

type ProofOfAddress {
  documentType: AddressDocumentType!
  documentDate: AWSDate!
  documentImages: [String!]
  verifiedDate: AWSDateTime
  verifiedBy: String
}

type CommunicationPreferences {
  receiveEmail: Boolean!
  receiveSMS: Boolean!
  receivePhone: Boolean!
  receivePost: Boolean!
  emailFrequency: EmailFrequency!
  preferredLanguage: String!
}

# ==========================================
# AML ALERT TYPE (Ongoing Monitoring)
# ==========================================

type AMLAlert {
  id: ID!
  investorId: ID!
  investor: Investor!
  alertType: AMLAlertType!
  severity: AlertSeverity!
  title: String!
  description: String!
  matchDetails: AWSJSON # Structured data about the match
  status: AlertStatus!
  riskScore: Float
  
  # Actions taken
  actionTaken: String
  actionDate: AWSDateTime
  
  # Review details
  reviewedBy: String
  reviewedAt: AWSDateTime
  reviewNotes: String
  
  # Resolution
  resolution: AlertResolution
  resolutionNotes: String
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

# ==========================================
# RESPONSE TYPES
# ==========================================

type RegistrationResponse {
  investor: Investor!
  message: String!
  nextSteps: [String!]!
}

type EmailVerificationResponse {
  success: Boolean!
  message: String!
  investor: Investor
}

type KYCSubmissionResponse {
  success: Boolean!
  message: String!
  kycStatus: KYCStatus!
  estimatedReviewTime: String
}

type AMLCheckResponse {
  success: Boolean!
  status: AMLStatus!
  riskLevel: RiskLevel!
  matchesFound: Int!
  details: String
  requiresReview: Boolean!
}

# ==========================================
# PROPERTY & INVESTMENT TYPES
# ==========================================

type Property {
  id: ID!
  address: String!
  postcode: String!
  city: String
  propertyType: PropertyType!
  purchasePrice: Float!
  currentValuation: Float!
  status: PropertyStatus!
  images: [String!]
  acquisitionDate: AWSDate!
  totalInvested: Float
  investments: [Investment!]
  developments: [Development!]
  documents: [Document!]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type DashboardProperty {
  id: ID!
  address: String!
  postcode: String!
  city: String
  propertyType: PropertyType!
  currentValuation: Float!
  status: PropertyStatus!
  equityPercentage: Float!
  investmentValue: Float!
  investmentAmount: Float!
}

type Investment {
  id: ID!
  investorId: ID!
  investor: Investor
  propertyId: ID!
  property: Property
  investmentAmount: Float!
  equityPercentage: Float!
  investmentDate: AWSDate!
  currentValue: Float!
  roi: Float!
  status: InvestmentStatus!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Transaction {
  id: ID!
  investorId: ID!
  investor: Investor
  propertyId: ID
  property: Property
  type: TransactionType!
  amount: Float!
  description: String!
  date: AWSDate!
  reference: String
  createdAt: AWSDateTime!
}

type Document {
  id: ID!
  investorId: ID
  investor: Investor
  propertyId: ID
  property: Property
  title: String!
  description: String
  fileKey: String!
  fileType: String!
  fileSize: Int!
  uploadDate: AWSDateTime!
  category: DocumentCategory!
  url: String # Presigned URL (generated on request)
}

type Development {
  id: ID!
  propertyId: ID!
  property: Property
  title: String!
  description: String!
  status: String!
  updateDate: AWSDateTime!
  images: [String!]
  createdAt: AWSDateTime!
}

type Notification {
  id: ID!
  investorId: ID!
  investor: Investor
  title: String!
  message: String!
  type: NotificationType!
  isRead: Boolean!
  createdAt: AWSDateTime!
  link: String
}

# ==========================================
# DASHBOARD TYPES
# ==========================================

type InvestorDashboard {
  totalInvested: Float!
  portfolioValue: Float!
  totalROI: Float!
  activeInvestments: Int!
  recentTransactions: [Transaction!]!
  unreadNotifications: Int!
  properties: [DashboardProperty!]!
  kycStatus: KYCStatus!
  verificationLevel: VerificationLevel!
  accountStatus: AccountStatus!
}

type AdminDashboard {
  totalInvestors: Int!
  totalProperties: Int!
  totalCapitalRaised: Float!
  totalPortfolioValue: Float!
  averageROI: Float!
  recentInvestments: [Investment!]!
  propertiesByStatus: [PropertyStatusCount!]!
  pendingKYCReviews: Int!
  pendingAMLAlerts: Int!
}

type PropertyStatusCount {
  status: PropertyStatus!
  count: Int!
}

type KYCReviewQueue {
  pending: [Investor!]!
  inProgress: [Investor!]!
  requiresMoreInfo: [Investor!]!
  totalCount: Int!
}

# ==========================================
# ENUMS
# ==========================================

enum ContactMethod {
  EMAIL
  PHONE
  SMS
  POST
  WHATSAPP
}

enum EmploymentStatus {
  EMPLOYED_FULL_TIME
  EMPLOYED_PART_TIME
  SELF_EMPLOYED
  UNEMPLOYED
  RETIRED
  STUDENT
  OTHER
}

enum SourceOfFunds {
  SALARY
  BUSINESS_INCOME
  SAVINGS
  INHERITANCE
  INVESTMENT_RETURNS
  GIFT
  PROPERTY_SALE
  PENSION
  OTHER
}

enum InvestorType {
  INDIVIDUAL
  JOINT
  COMPANY
  TRUST
  PENSION_FUND
  CHARITY
  OTHER
}

enum InvestorCategory {
  RETAIL
  PROFESSIONAL
  ELIGIBLE_COUNTERPARTY
  HIGH_NET_WORTH
  SOPHISTICATED
}

enum RiskTolerance {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

enum InvestmentExperience {
  NONE
  LIMITED
  MODERATE
  EXTENSIVE
  PROFESSIONAL
}

enum IncomeRange {
  UNDER_20K
  RANGE_20K_40K
  RANGE_40K_60K
  RANGE_60K_100K
  RANGE_100K_150K
  OVER_150K
  PREFER_NOT_SAY
}

enum BankAccountType {
  CURRENT
  SAVINGS
  BUSINESS
  JOINT
}

enum KYCStatus {
  PENDING
  IN_PROGRESS
  APPROVED
  REJECTED
  EXPIRED
  REQUIRES_UPDATE
  MORE_INFO_REQUIRED
}

enum AMLStatus {
  PENDING
  PASSED
  FAILED
  REVIEW_REQUIRED
}

enum SanctionsStatus {
  NOT_CHECKED
  CLEAR
  POTENTIAL_MATCH
  CONFIRMED_MATCH
}

enum AccountStatus {
  ACTIVE
  PENDING_VERIFICATION
  SUSPENDED
  CLOSED
  DORMANT
}

enum AccountTier {
  BASIC
  PREMIUM
  VIP
  INSTITUTIONAL
}

enum VerificationLevel {
  UNVERIFIED
  EMAIL_VERIFIED
  PHONE_VERIFIED
  ID_VERIFIED
  FULLY_VERIFIED
}

enum IDDocumentType {
  PASSPORT
  DRIVING_LICENSE
  NATIONAL_ID
  RESIDENCE_PERMIT
}

enum AddressDocumentType {
  UTILITY_BILL
  BANK_STATEMENT
  COUNCIL_TAX_BILL
  MORTGAGE_STATEMENT
  TENANCY_AGREEMENT
  GOVERNMENT_LETTER
}

enum VerificationMethod {
  MANUAL_REVIEW
  AUTOMATED_CHECK
  VIDEO_VERIFICATION
  THIRD_PARTY_SERVICE
}

enum EmailFrequency {
  REAL_TIME
  DAILY_DIGEST
  WEEKLY_DIGEST
  MONTHLY_SUMMARY
  IMPORTANT_ONLY
}

enum PropertyType {
  RESIDENTIAL
  COMMERCIAL
  MIXED_USE
  LAND
}

enum PropertyStatus {
  ACQUISITION
  DEVELOPMENT
  COMPLETED
  SOLD
}

enum InvestmentStatus {
  ACTIVE
  COMPLETED
  PENDING
}

enum TransactionType {
  INVESTMENT
  DIVIDEND
  PROFIT_SHARE
  WITHDRAWAL
  FEE
}

enum DocumentCategory {
  CONTRACT
  REPORT
  CERTIFICATE
  INVOICE
  VALUATION
  KYC_DOCUMENT
  IDENTITY_DOCUMENT
  ADDRESS_PROOF
  SOURCE_OF_FUNDS
  OTHER
}

enum NotificationType {
  INVESTMENT_UPDATE
  DOCUMENT_UPLOADED
  PAYMENT_RECEIVED
  PROPERTY_UPDATE
  KYC_STATUS_CHANGE
  AML_ALERT
  SYSTEM
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AMLAlertType {
  NEW_SANCTION
  ADVERSE_MEDIA
  PEP_STATUS_CHANGE
  HIGH_RISK_TRANSACTION
  NAME_MATCH_UPDATE
  COUNTRY_RISK_CHANGE
  SANCTIONS_LIST_UPDATE
}

enum AlertSeverity {
  CRITICAL  # Immediate action required
  HIGH      # Review within 24 hours
  MEDIUM    # Review within 1 week
  LOW       # Informational
}

enum AlertStatus {
  NEW
  REVIEWING
  RESOLVED
  FALSE_POSITIVE
  ESCALATED
}

enum AlertResolution {
  FALSE_POSITIVE
  ACCOUNT_SUSPENDED
  ACCOUNT_CLOSED
  ENHANCED_MONITORING
  NO_ACTION_REQUIRED
  REFERRED_TO_AUTHORITIES
}

# ==========================================
# INPUTS
# ==========================================

input RegisterInvestorInput {
  email: String!
  password: String!
  firstName: String!
  lastName: String!
  phone: String!
  dateOfBirth: AWSDate!
  address: AddressInput!
  investorType: InvestorType!
  marketingConsent: Boolean!
  termsAccepted: Boolean!
}

input CompleteProfileInput {
  investorId: ID!
  middleName: String
  title: String
  mobilePhone: String
  mailingAddress: AddressInput
  employmentStatus: EmploymentStatus
  occupation: String
  employer: String
  annualIncome: IncomeRange
  preferredContactMethod: ContactMethod
}

input SubmitIdentityInput {
  investorId: ID!
  documentType: IDDocumentType!
  documentNumber: String!
  issuingCountry: String!
  issueDate: AWSDate
  expiryDate: AWSDate!
  documentImages: [String!]! # S3 keys
}

input SubmitProofOfAddressInput {
  investorId: ID!
  documentType: AddressDocumentType!
  documentDate: AWSDate!
  documentImages: [String!]! # S3 keys
}

input SubmitSourceOfFundsInput {
  investorId: ID!
  sourceOfFunds: SourceOfFunds!
  sourceOfWealth: String!
  annualIncome: IncomeRange!
  supportingDocuments: [String!] # S3 keys (optional)
}

input SubmitPEPDeclarationInput {
  investorId: ID!
  isPEP: Boolean!
  pepDetails: String
  pepPosition: String
  pepCountry: String
}

input AddBankAccountInput {
  investorId: ID!
  accountName: String!
  bankName: String!
  accountNumber: String!
  sortCode: String!
  iban: String
  swiftCode: String
  isPrimary: Boolean!
  currency: String!
  accountType: BankAccountType!
}

input AddressInput {
  addressLine1: String!
  addressLine2: String
  city: String!
  county: String
  postcode: String!
  country: String!
  residencySince: AWSDate
  isCurrentAddress: Boolean!
}

input NextOfKinInput {
  firstName: String!
  lastName: String!
  relationship: String!
  phone: String!
  email: String
  address: AddressInput
  dateOfBirth: AWSDate
}

input EmergencyContactInput {
  firstName: String!
  lastName: String!
  relationship: String!
  phone: String!
  alternativePhone: String
  email: String
}

input CommunicationPreferencesInput {
  receiveEmail: Boolean
  receiveSMS: Boolean
  receivePhone: Boolean
  receivePost: Boolean
  emailFrequency: EmailFrequency
  preferredLanguage: String
}

input UpdateInvestorInput {
  id: ID!
  firstName: String
  lastName: String
  middleName: String
  phone: String
  mobilePhone: String
  email: String # Admin only
  address: AddressInput
  employmentStatus: EmploymentStatus
  occupation: String
  employer: String
  notes: String # Admin only
}

input CreatePropertyInput {
  address: String!
  postcode: String!
  city: String
  propertyType: PropertyType!
  purchasePrice: Float!
  currentValuation: Float!
  status: PropertyStatus!
  images: [String!]
  acquisitionDate: AWSDate!
}

input UpdatePropertyInput {
  id: ID!
  currentValuation: Float
  status: PropertyStatus
  images: [String!]
}

input CreateInvestmentInput {
  investorId: ID!
  propertyId: ID!
  investmentAmount: Float!
  equityPercentage: Float!
}

input CreateTransactionInput {
  investorId: ID!
  propertyId: ID
  type: TransactionType!
  amount: Float!
  description: String!
  date: AWSDate
  reference: String
}

input UploadDocumentInput {
  investorId: ID
  propertyId: ID
  title: String!
  description: String
  fileKey: String!
  fileType: String!
  fileSize: Int!
  category: DocumentCategory!
}

input CreateDevelopmentInput {
  propertyId: ID!
  title: String!
  description: String!
  status: String!
  images: [String!]
}

input SendNotificationInput {
  investorId: ID
  investorIds: [ID!]
  title: String!
  message: String!
  type: NotificationType!
  link: String
}

input ReviewAMLAlertInput {
  alertId: ID!
  status: AlertStatus!
  resolution: AlertResolution
  actionTaken: String
  reviewNotes: String
}

# ==========================================
# PAGINATION
# ==========================================

type InvestorConnection {
  items: [Investor!]!
  nextToken: String
  total: Int
}

type InvestmentConnection {
  items: [Investment!]!
  nextToken: String
}

type TransactionConnection {
  items: [Transaction!]!
  nextToken: String
}

type DocumentConnection {
  items: [Document!]!
  nextToken: String
}

type NotificationConnection {
  items: [Notification!]!
  nextToken: String
}

type DevelopmentConnection {
  items: [Development!]!
  nextToken: String
}

type AMLAlertConnection {
  items: [AMLAlert!]!
  nextToken: String
  totalCount: Int
  criticalCount: Int
  highCount: Int
}

# ==========================================
# QUERIES
# ==========================================

type Query {
  # Investors
  getInvestor(id: ID!): Investor
  getInvestorByEmail(email: String!): Investor # Admin only
  listInvestors(limit: Int, nextToken: String): InvestorConnection!
  
  # KYC & Compliance Queries
  getMyKYCStatus: KYCStatus!
  getKYCReviewQueue: KYCReviewQueue! # Admin only
  listPendingKYC(limit: Int, nextToken: String): InvestorConnection! # Admin only
  listInvestorsRequiringAMLReview(limit: Int, nextToken: String): InvestorConnection! # Admin only
  listPEPInvestors(limit: Int, nextToken: String): InvestorConnection! # Admin only

  # Properties
  getProperty(id: ID!): Property
  listProperties(limit: Int, nextToken: String): [Property!]!
  listPropertiesByStatus(
    status: PropertyStatus!
    limit: Int
    nextToken: String
  ): [Property!]!

  # Investments
  getInvestment(id: ID!): Investment
  listInvestmentsByInvestor(
    investorId: ID!
    limit: Int
    nextToken: String
  ): InvestmentConnection!
  listInvestmentsByProperty(
    propertyId: ID!
    limit: Int
    nextToken: String
  ): InvestmentConnection!

  # Transactions
  getTransaction(id: ID!): Transaction
  listTransactionsByInvestor(
    investorId: ID!
    limit: Int
    nextToken: String
  ): TransactionConnection!

  # Documents
  getDocument(id: ID!): Document
  listDocumentsByInvestor(
    investorId: ID!
    limit: Int
    nextToken: String
  ): DocumentConnection!
  listDocumentsByProperty(
    propertyId: ID!
    limit: Int
    nextToken: String
  ): DocumentConnection!
  generateDocumentUrl(id: ID!): String!

  # Notifications
  listNotificationsByInvestor(
    investorId: ID!
    limit: Int
    nextToken: String
  ): NotificationConnection!

  # Developments
  listDevelopmentsByProperty(
    propertyId: ID!
    limit: Int
    nextToken: String
  ): DevelopmentConnection!
  
  # AML Alerts
  getAMLAlert(id: ID!): AMLAlert # Admin/Compliance only
  listAMLAlerts(
    status: AlertStatus
    severity: AlertSeverity
    limit: Int
    nextToken: String
  ): AMLAlertConnection! # Admin/Compliance only
  listAMLAlertsByInvestor(
    investorId: ID!
    limit: Int
    nextToken: String
  ): AMLAlertConnection! # Admin/Compliance only

  # Dashboard Stats
  getInvestorDashboard(investorId: ID!): InvestorDashboard!
  getAdminDashboard: AdminDashboard!
}

# ==========================================
# MUTATIONS
# ==========================================

type Mutation {
  # ========================================
  # PUBLIC REGISTRATION (No auth required)
  # ========================================

  registerInvestor(input: RegisterInvestorInput!): RegistrationResponse!
  verifyEmail(token: String!): EmailVerificationResponse!
  resendVerificationEmail(email: String!): Boolean!

  # ========================================
  # PROFILE COMPLETION (Auth required)
  # ========================================

  completeProfile(input: CompleteProfileInput!): Investor!
  updateInvestor(input: UpdateInvestorInput!): Investor!

  # ========================================
  # KYC DOCUMENT SUBMISSION (Self-service)
  # ========================================

  submitIdentityDocument(input: SubmitIdentityInput!): KYCSubmissionResponse!
  submitProofOfAddress(input: SubmitProofOfAddressInput!): KYCSubmissionResponse!
  submitSourceOfFunds(input: SubmitSourceOfFundsInput!): KYCSubmissionResponse!
  submitPEPDeclaration(input: SubmitPEPDeclarationInput!): Investor!
  addNextOfKin(investorId: ID!, input: NextOfKinInput!): Investor!
  addEmergencyContact(investorId: ID!, input: EmergencyContactInput!): Investor!

  # ========================================
  # BANK ACCOUNT MANAGEMENT (Self-service)
  # ========================================

  addBankAccount(input: AddBankAccountInput!): BankAccount!
  updateBankAccount(id: ID!, input: AddBankAccountInput!): BankAccount!
  deleteBankAccount(id: ID!): Boolean!
  setPrimaryBankAccount(investorId: ID!, bankAccountId: ID!): Investor!

  # ========================================
  # KYC REVIEW & APPROVAL (Admin/Compliance only)
  # ========================================

  approveKYC(investorId: ID!, notes: String): Investor!
  rejectKYC(investorId: ID!, reason: String!): Investor!
  requestMoreInfo(investorId: ID!, message: String!): Investor!

  # ========================================
  # COMPLIANCE (Admin/Compliance only)
  # ========================================

  runAMLCheck(investorId: ID!): AMLCheckResponse!
  runSanctionsCheck(investorId: ID!): Investor!
  runDailyAMLMonitoring: Int! # Returns number of investors checked
  updateAMLStatus(investorId: ID!, status: AMLStatus!, notes: String): Investor!
  updateSanctionsStatus(investorId: ID!, status: SanctionsStatus!, notes: String): Investor!
  reviewAMLAlert(input: ReviewAMLAlertInput!): AMLAlert!
  resolveAMLAlert(alertId: ID!, resolution: AlertResolution!, notes: String!): AMLAlert!

  # ========================================
  # ACCOUNT MANAGEMENT (Admin only)
  # ========================================

  suspendAccount(investorId: ID!, reason: String!): Investor!
  reactivateAccount(investorId: ID!): Investor!
  closeAccount(investorId: ID!, reason: String!): Investor!

  # ========================================
  # PROPERTIES & INVESTMENTS
  # ========================================

  createProperty(input: CreatePropertyInput!): Property!
  updateProperty(input: UpdatePropertyInput!): Property!
  createInvestment(input: CreateInvestmentInput!): Investment!
  createTransaction(input: CreateTransactionInput!): Transaction!
  uploadDocument(input: UploadDocumentInput!): Document!
  createDevelopment(input: CreateDevelopmentInput!): Development!
  sendNotification(input: SendNotificationInput!): Notification!
  markNotificationRead(id: ID!): Notification!
}

# ==========================================
# SUBSCRIPTIONS (Strategic Real-Time)
# ==========================================

type Subscription {
  # User-facing subscriptions
  onMyKYCStatusChanged(investorId: ID!): Investor
    @aws_subscribe(mutations: ["approveKYC", "rejectKYC", "requestMoreInfo"])
  
  onMyNotificationCreated(investorId: ID!): Notification
    @aws_subscribe(mutations: ["sendNotification"])
  
  onMyInvestmentCreated(investorId: ID!): Investment
    @aws_subscribe(mutations: ["createInvestment"])
  
  # Admin/Compliance subscriptions
  onAMLAlertCreated: AMLAlert
    @aws_subscribe(mutations: ["runDailyAMLMonitoring", "runAMLCheck"])
  
  onKYCReviewAdded: Investor
    @aws_subscribe(mutations: ["submitIdentityDocument", "submitProofOfAddress"])
  
  onInvestorStatusChanged(investorId: ID!): Investor
    @aws_subscribe(mutations: ["suspendAccount", "reactivateAccount", "approveKYC", "closeAccount"])
    
  # Property updates
  onDevelopmentCreated(propertyId: ID!): Development
    @aws_subscribe(mutations: ["createDevelopment"])
}

# ==========================================
# AUTHORIZATION RULES
# ==========================================

# Authorization Rules (enforced in Lambda resolvers):
#
# PUBLIC (No auth):
# - registerInvestor
# - verifyEmail
# - resendVerificationEmail
#
# INVESTOR (Self):
# - View own data: getInvestor, getInvestorDashboard
# - Update own profile: updateInvestor (limited fields)
# - Submit KYC: submitIdentityDocument, submitProofOfAddress, submitSourceOfFunds
# - Manage own bank accounts: addBankAccount, updateBankAccount, deleteBankAccount
# - View own investments, transactions, documents, notifications
#
# ADMIN:
# - All investor operations
# - Create/update properties
# - Create investments and transactions
# - Upload documents
# - Send notifications
#
# COMPLIANCE:
# - All KYC operations: approveKYC, rejectKYC, requestMoreInfo
# - All AML operations: runAMLCheck, runSanctionsCheck, reviewAMLAlert
# - View pending KYC queue
# - View AML alerts
# - Suspend/reactivate accounts (requires additional approval)
#
# SYSTEM (Background jobs):
# - runDailyAMLMonitoring (scheduled Lambda)