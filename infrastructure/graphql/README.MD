# GraphQL Schema Organization

## ğŸ“ File Structure

```
infrastructure/graphql/
â”œâ”€â”€ schema.graphql           # Main import file (references others)
â”œâ”€â”€ investor.graphql         # All investor-related (798 lines) ğŸ‘¥
â”œâ”€â”€ property.graphql         # All property-related (396 lines) ğŸ 
â”œâ”€â”€ admin.graphql            # All admin-related (423 lines) ğŸ‘¨â€ğŸ’¼
â””â”€â”€ schema-merged.graphql    # Combined file for deployment (1617 lines) âœ…
```

---

## ğŸ¯ Why Separate Admin Schema?

### âœ… Better Organization
- **Investor stuff** â†’ `investor.graphql`
- **Property stuff** â†’ `property.graphql`
- **Admin stuff** â†’ `admin.graphql` â­

### âœ… Clear Separation of Concerns
- Admin dashboard doesn't belong with properties
- Audit logs are system-wide, not property-specific
- Bulk operations span multiple domains

### âœ… Role-Based Development
- Investor team â†’ Works on `investor.graphql`
- Property team â†’ Works on `property.graphql`
- **Admin/Ops team** â†’ Works on `admin.graphql`

### âœ… Security & Authorization
- All admin queries/mutations in one place
- Easy to see what requires admin access
- Clear audit trail requirements

---

## ğŸ“‹ File Contents

### 1. **`investor.graphql`** (798 lines) ğŸ‘¥

**Domain:** Investor management, KYC, AML, compliance

**Types:**
- `Investor` - Main investor type
- `Address`, `BankAccount`, `NextOfKin`, `EmergencyContact`
- `IdentityVerification`, `ProofOfAddress`
- `AMLAlert` - AML monitoring alerts
- `InvestorDashboard` - Investor's personal dashboard
- `KYCReviewQueue` - For compliance officers

**Enums:**
- Contact & Communication
- Employment & Income
- Investment preferences
- KYC/AML status
- Compliance flags

**Mutations:**
- Registration: `registerInvestor`, `verifyEmail`
- KYC: `submitIdentityDocument`, `approveKYC`, `rejectKYC`
- AML: `runAMLCheck`, `resolveAMLAlert`
- Account: `suspendAccount`, `closeAccount`

**Who Uses:**
- Investors (self-service)
- Compliance officers
- Admins

---

### 2. **`property.graphql`** (396 lines) ğŸ 

**Domain:** Properties, investments, transactions, documents

**Types:**
- `Property`, `DashboardProperty`
- `Investment`, `Transaction`
- `Document`, `Development`
- `Notification`

**Enums:**
- `PropertyType`, `PropertyStatus`
- `InvestmentStatus`, `TransactionType`
- `DocumentCategory`, `NotificationType`

**Mutations:**
- Properties: `createProperty`, `updateProperty`
- Investments: `createInvestment`
- Transactions: `createTransaction`
- Documents: `uploadDocument`
- Developments: `createDevelopment`

**Who Uses:**
- Property managers
- Investors (view only)
- Admins

---

### 3. **`admin.graphql`** (423 lines) ğŸ‘¨â€ğŸ’¼ â­ NEW

**Domain:** Admin operations, analytics, system management

**Types:**
- `AdminDashboard` - Main admin dashboard
- `InvestorStats` - Investor analytics
- `PropertyStats` - Property analytics
- `FinancialStats` - Financial metrics
- `ComplianceStats` - Compliance metrics
- `AuditLog` - Full audit trail
- `AdminActivity` - Admin action tracking
- `SystemHealth` - System monitoring
- `BulkOperationResult` - Bulk operation results

**Enums:**
- `AuditAction` - Every trackable action
- `AdminActionType` - Admin-specific actions
- `SystemStatus`, `ServiceStatus` - Health monitoring
- `AdminNotificationType` - Admin alerts
- `ReportFormat` - PDF, CSV, Excel

**Queries:**
```graphql
# Dashboards & Stats
getAdminDashboard
getInvestorStats
getPropertyStats
getFinancialStats
getComplianceStats

# Audit & Activity
listAuditLogs
getAuditLog
listAdminActivity

# System
getSystemHealth

# Reports
generateInvestorReport
generateFinancialReport
generateComplianceReport
```

**Mutations:**
```graphql
# Bulk Operations
bulkApproveKYC
bulkRejectKYC
bulkSendNotification
bulkSuspendAccounts

# System Operations
triggerBackup
clearCache
syncData

# Audit
logAuditEvent
```

**Subscriptions:**
```graphql
# Real-time admin alerts
onAdminNotification
onSystemHealthChanged
```

**Who Uses:**
- Admins only
- Compliance officers (limited)
- Super admins

---

### 4. **`schema-merged.graphql`** (1617 lines)

Combined file ready to deploy:
```bash
cat investor.graphql property.graphql admin.graphql > schema-merged.graphql
```

---

## ğŸš€ Deployment

### Quick Deploy:

```bash
cd infrastructure/graphql

# Deploy the merged file
aws appsync update-graphql-api \
  --api-id <your-api-id> \
  --schema file://schema-merged.graphql
```

### After Making Changes:

```bash
# Edit investor.graphql, property.graphql, or admin.graphql

# Re-merge
cat investor.graphql property.graphql admin.graphql > schema-merged.graphql

# Deploy
aws appsync update-graphql-api \
  --api-id <your-api-id> \
  --schema file://schema-merged.graphql
```

---

## ğŸ“Š What's in Each File

| Domain | File | Types | Enums | Queries | Mutations | Who Uses |
|--------|------|-------|-------|---------|-----------|----------|
| **Investors** | `investor.graphql` | 14 | 20 | 12 | 27 | Investors, Compliance |
| **Properties** | `property.graphql` | 11 | 6 | 14 | 9 | Property team, Investors |
| **Admin** | `admin.graphql` | 11 | 7 | 9 | 8 | Admins only |
| **TOTAL** | `schema-merged.graphql` | 36 | 33 | 35 | 44 | Everyone |

---

## ğŸ” Quick Reference

| What You Need | File |
|---------------|------|
| Investor enums | `investor.graphql` |
| KYC types | `investor.graphql` |
| AML types | `investor.graphql` |
| Property enums | `property.graphql` |
| Investment types | `property.graphql` |
| **Admin dashboard** | `admin.graphql` â­ |
| **Audit logs** | `admin.graphql` â­ |
| **System health** | `admin.graphql` â­ |
| **Bulk operations** | `admin.graphql` â­ |
| **Deploy to AWS** | `schema-merged.graphql` âœ… |

---

## ğŸ¯ Example Workflows

### Adding Admin Feature:

1. Open `admin.graphql`
2. Add your type:
```graphql
type RevenueReport {
  month: String!
  revenue: Float!
  fees: Float!
  profit: Float!
}
```
3. Add query:
```graphql
type Query {
  getMonthlyRevenue(year: Int!): [RevenueReport!]!
}
```
4. Re-merge:
```bash
cat investor.graphql property.graphql admin.graphql > schema-merged.graphql
```
5. Deploy

### Adding Investor Field:

1. Open `investor.graphql`
2. Find `type Investor`
3. Add field
4. Re-merge and deploy

### Adding Property Type:

1. Open `property.graphql`
2. Add type/enum
3. Re-merge and deploy

---

## âœ… Benefits of Separate Admin Schema

### Before (Admin in Property):
```
property.graphql
â”œâ”€â”€ Property type
â”œâ”€â”€ Investment type
â”œâ”€â”€ AdminDashboard  âŒ Doesn't belong here
â””â”€â”€ Audit logs      âŒ Not property-specific
```

### After (Admin Separated):
```
investor.graphql    ğŸ‘¥ Investor domain
property.graphql    ğŸ  Property domain
admin.graphql       ğŸ‘¨â€ğŸ’¼ Admin/system domain
```

### Why Better:

1. **Clear Ownership**
   - Property team doesn't touch admin code
   - Admin team doesn't touch property code
   - Fewer merge conflicts

2. **Better Security**
   - All admin operations in one file
   - Easy to audit admin access
   - Clear authorization rules

3. **Easier to Find**
   - Need audit logs? â†’ `admin.graphql`
   - Need dashboard? â†’ `admin.graphql`
   - Need stats? â†’ `admin.graphql`

4. **Scalability**
   - Can add more admin features without bloating property schema
   - Can extract admin to separate service later
   - Can have different deployment cycles

---

## ğŸ“Š Schema Statistics

### `investor.graphql`
- **Lines:** 798
- **Types:** 14
- **Enums:** 20
- **Inputs:** 13
- **Queries:** 12
- **Mutations:** 27
- **Subscriptions:** 4
- **Focus:** KYC, AML, compliance, investor management

### `property.graphql`
- **Lines:** 396
- **Types:** 11
- **Enums:** 6
- **Inputs:** 7
- **Queries:** 14
- **Mutations:** 9
- **Subscriptions:** 3
- **Focus:** Properties, investments, transactions

### `admin.graphql` â­
- **Lines:** 423
- **Types:** 11
- **Enums:** 7
- **Inputs:** 2
- **Queries:** 9
- **Mutations:** 8
- **Subscriptions:** 2
- **Focus:** Admin operations, analytics, system health

### `schema-merged.graphql`
- **Total Lines:** 1617
- **Total Types:** 36
- **Total Enums:** 33
- **Total Inputs:** 22
- **Total Queries:** 35
- **Total Mutations:** 44
- **Total Subscriptions:** 9

---

## ğŸ” Authorization by File

### `investor.graphql`
- **Public:** `registerInvestor`, `verifyEmail`
- **Investor (self):** View/update own profile, submit KYC
- **Compliance:** Approve/reject KYC, review AML
- **Admin:** Everything

### `property.graphql`
- **Investor:** View properties they've invested in
- **Property Manager:** Create/update properties
- **Admin:** Everything

### `admin.graphql`
- **Admin Only:** All operations
- **Compliance:** Limited stats access
- **Finance:** Financial reports only
- **Super Admin:** Bulk operations, system management

---

## ğŸ’¡ Best Practices

1. **Keep domains separate** - Don't mix investor/property/admin
2. **Always merge after changes** - Update `schema-merged.graphql`
3. **Document authorization** - Clear comments on who can access what
4. **Version control all files** - Commit all three schemas
5. **Test before deploy** - Validate merged schema

---

## ğŸ‰ You're All Set!

Your schema is now organized into **3 logical domains**:

1. ğŸ‘¥ **Investors** â†’ `investor.graphql`
2. ğŸ  **Properties** â†’ `property.graphql`
3. ğŸ‘¨â€ğŸ’¼ **Admin** â†’ `admin.graphql`

**Quick Deploy:**
```bash
cd infrastructure/graphql
cat investor.graphql property.graphql admin.graphql > schema-merged.graphql
aws appsync update-graphql-api --api-id <api-id> --schema file://schema-merged.graphql
```

ğŸš€ Deployment Flow

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Developer    â”‚
â”‚ makes change â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit one of:                 â”‚
â”‚ â€¢ investor.graphql           â”‚
â”‚ â€¢ property.graphql           â”‚
â”‚ â€¢ admin.graphql              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Run merge command:           â”‚
â”‚ cat investor.graphql \       â”‚
â”‚     property.graphql \       â”‚
â”‚     admin.graphql \          â”‚
â”‚     > schema-merged.graphql  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Commit all files:            â”‚
â”‚ â€¢ investor.graphql           â”‚
â”‚ â€¢ property.graphql           â”‚
â”‚ â€¢ admin.graphql              â”‚
â”‚ â€¢ schema-merged.graphql      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deploy to AppSync:           â”‚
â”‚ aws appsync update-graphql   â”‚
â”‚   --schema schema-merged     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Live in production!        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜