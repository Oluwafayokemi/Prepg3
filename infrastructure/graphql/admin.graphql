# schema/admin.graphql
# ADMIN OPERATIONS (Non-destructive)
# Accessible by: Admin, Compliance, PropertyManager, Support
# Operations that help manage the platform but don't delete data

# ===========================================
# DASHBOARD & STATS TYPES
# ===========================================

type AdminDashboard {
  # Overview metrics
  totalInvestors: Int!
  totalProperties: Int!
  totalCapitalRaised: Float!
  totalPortfolioValue: Float!
  averageROI: Float!
  
  # Recent activity
  recentInvestments: [Investment!]!
  recentTransactions: [Transaction!]!
  
  # Property breakdown
  propertiesByStatus: [PropertyStatusCount!]!
  
  # Compliance alerts
  pendingKYCReviews: Int!
  pendingAMLAlerts: Int!
  activePEPInvestors: Int!
  suspendedAccounts: Int!
  
  # Financial overview
  monthlyRevenue: Float!
  totalFees: Float!
  outstandingPayments: Float!
}

type PropertyStatusCount {
  status: PropertyStatus!
  count: Int!
}

type InvestorStats {
  total: Int!
  active: Int!
  pendingVerification: Int!
  suspended: Int!
  closed: Int!
  newThisMonth: Int!
  newThisWeek: Int!
  byTier: [InvestorTierCount!]!
  byCategory: [InvestorCategoryCount!]!
}

type InvestorTierCount {
  tier: AccountTier!
  count: Int!
}

type InvestorCategoryCount {
  category: InvestorCategory!
  count: Int!
}

type PropertyStats {
  total: Int!
  byStatus: [PropertyStatusCount!]!
  byType: [PropertyTypeCount!]!
  totalValue: Float!
  averageROI: Float!
}

type PropertyTypeCount {
  type: PropertyType!
  count: Int!
}

type FinancialStats {
  totalCapitalRaised: Float!
  totalPortfolioValue: Float!
  totalFees: Float!
  monthlyRevenue: Float!
  revenueThisYear: Float!
  transactionVolumeLast30Days: Float!
  averageInvestmentSize: Float!
}

# ===========================================
# COMPLIANCE TYPES
# ===========================================

type KYCReviewQueue {
  pending: [Investor!]!
  inProgress: [Investor!]!
  requiresMoreInfo: [Investor!]!
  totalCount: Int!
}

type ComplianceStats {
  totalInvestors: Int!
  verifiedInvestors: Int!
  pendingKYCCount: Int!
  rejectedKYCCount: Int!
  pepCount: Int!
  highRiskCount: Int!
  amlAlertsLast30Days: Int!
  sanctionMatchesLast30Days: Int!
}

# ===========================================
# AUDIT & ACTIVITY TYPES
# ===========================================

type AuditLog {
  id: ID!
  timestamp: AWSDateTime!
  userId: ID!
  userName: String!
  userRole: String!
  action: AuditAction!
  entityType: String!
  entityId: ID!
  changes: AWSJSON
  ipAddress: String
  userAgent: String
  status: AuditStatus!
  details: String
}

type AuditLogConnection {
  items: [AuditLog!]!
  nextToken: String
  totalCount: Int
}

type AdminActivity {
  id: ID!
  adminId: ID!
  adminName: String!
  action: AdminActionType!
  description: String!
  entityType: String
  entityId: ID
  timestamp: AWSDateTime!
}

type AdminActivityConnection {
  items: [AdminActivity!]!
  nextToken: String
}

# ===========================================
# SYSTEM HEALTH
# ===========================================

type SystemHealth {
  status: SystemStatus!
  apiResponseTime: Float!
  databaseResponseTime: Float!
  lambdaErrors: Int!
  amlServiceStatus: ServiceStatus!
  emailServiceStatus: ServiceStatus!
  s3ServiceStatus: ServiceStatus!
  lastChecked: AWSDateTime!
}

# ===========================================
# ENUMS
# ===========================================

enum AuditAction {
  # Investor actions
  INVESTOR_CREATED
  INVESTOR_UPDATED
  INVESTOR_SUSPENDED
  INVESTOR_REACTIVATED
  INVESTOR_CLOSED
  
  # KYC actions
  KYC_SUBMITTED
  KYC_APPROVED
  KYC_REJECTED
  KYC_MORE_INFO_REQUESTED
  
  # AML actions
  AML_CHECK_RUN
  AML_ALERT_CREATED
  AML_ALERT_RESOLVED
  SANCTIONS_CHECK_RUN
  
  # Security actions
  PASSWORD_RESET
  EMAIL_CHANGED
  PHONE_CHANGED
  
  # Financial actions
  INVESTMENT_CREATED
  TRANSACTION_CREATED
  WITHDRAWAL_PROCESSED
  
  # Property actions
  PROPERTY_CREATED
  PROPERTY_UPDATED
  PROPERTY_SOLD
  
  # Admin actions
  ADMIN_LOGIN
  ADMIN_LOGOUT
  SETTINGS_CHANGED
  BULK_ACTION_PERFORMED
  
  # Data actions
  DATA_EXPORT
  DATA_IMPORT
  BACKUP_CREATED
}

enum AuditStatus {
  SUCCESS
  FAILED
  PENDING
  PARTIAL
}

enum AdminActionType {
  LOGIN
  LOGOUT
  KYC_REVIEW
  AML_REVIEW
  INVESTOR_UPDATE
  PROPERTY_UPDATE
  TRANSACTION_CREATE
  NOTIFICATION_SEND
  REPORT_GENERATE
  SETTINGS_CHANGE
  BULK_ACTION
  DATA_EXPORT
}

enum SystemStatus {
  HEALTHY
  DEGRADED
  DOWN
}

enum ServiceStatus {
  OPERATIONAL
  DEGRADED
  OUTAGE
  MAINTENANCE
}

enum ReportFormat {
  PDF
  CSV
  EXCEL
}

# ===========================================
# INPUTS
# ===========================================

input AuditLogFilterInput {
  userId: ID
  action: AuditAction
  entityType: String
  entityId: ID
  startDate: AWSDateTime
  endDate: AWSDateTime
  status: AuditStatus
}

input AdminActivityFilterInput {
  adminId: ID
  action: AdminActionType
  startDate: AWSDateTime
  endDate: AWSDateTime
}

# ===========================================
# QUERIES
# ===========================================

extend type Query {
  # Dashboard & Stats
  getAdminDashboard: AdminDashboard!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  getInvestorStats: InvestorStats!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
  
  getPropertyStats: PropertyStats!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "PropertyManager"])
  
  getFinancialStats: FinancialStats!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  getComplianceStats: ComplianceStats!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
  
  # KYC Queue
  getKYCReviewQueue: KYCReviewQueue!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
  
  # Audit Logs
  listAuditLogs(
    filter: AuditLogFilterInput
    limit: Int
    nextToken: String
  ): AuditLogConnection!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  getAuditLog(id: ID!): AuditLog!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # Admin Activity
  listAdminActivity(
    filter: AdminActivityFilterInput
    limit: Int
    nextToken: String
  ): AdminActivityConnection!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # System Health
  getSystemHealth: SystemHealth!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # Reports
  generateInvestorReport(
    startDate: AWSDate
    endDate: AWSDate
    format: ReportFormat
  ): String!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  generateFinancialReport(
    startDate: AWSDate
    endDate: AWSDate
    format: ReportFormat
  ): String!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  generateComplianceReport(
    startDate: AWSDate
    endDate: AWSDate
    format: ReportFormat
  ): String!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
}

# ===========================================
# MUTATIONS
# ===========================================

extend type Mutation {
  # Bulk KYC Operations
  bulkApproveKYC(investorIds: [ID!]!): BulkOperationResult!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
  
  bulkRejectKYC(investorIds: [ID!]!, reason: String!): BulkOperationResult!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin", "Compliance"])
  
  # Bulk Notifications
  bulkSendNotification(
    investorIds: [ID!]!
    notification: SendNotificationInput!
  ): BulkOperationResult!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # Account Suspension (Temporary - NOT deletion)
  bulkSuspendAccounts(investorIds: [ID!]!, reason: String!): BulkOperationResult!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # System Operations (Non-destructive)
  triggerBackup: Boolean!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  clearCache: Boolean!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  syncData: Boolean!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
  
  # Audit Logging
  logAuditEvent(
    action: AuditAction!
    entityType: String!
    entityId: ID!
    changes: AWSJSON
    details: String
  ): AuditLog!
    @aws_auth(cognito_groups: ["Admin", "SuperAdmin"])
}

# ===========================================
# BULK OPERATION TYPES
# ===========================================

type BulkOperationResult {
  totalProcessed: Int!
  successCount: Int!
  failureCount: Int!
  errors: [BulkOperationError!]
}

type BulkOperationError {
  investorId: ID!
  error: String!
}

# ===========================================
# SUBSCRIPTIONS
# ===========================================

extend type Subscription {
  # Real-time admin notifications
  onAdminNotification: AdminNotification
    @aws_subscribe(mutations: ["logAuditEvent"])
  
  # System health changes
  onSystemHealthChanged: SystemHealth
    @aws_subscribe(mutations: ["triggerBackup", "clearCache"])
}

type AdminNotification {
  type: AdminNotificationType!
  title: String!
  message: String!
  severity: NotificationSeverity!
  timestamp: AWSDateTime!
  link: String
}

enum AdminNotificationType {
  NEW_KYC_SUBMISSION
  NEW_AML_ALERT
  SYSTEM_ERROR
  BACKUP_COMPLETED
  LARGE_TRANSACTION
  SUSPICIOUS_ACTIVITY
  SERVICE_DEGRADED
}

enum NotificationSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
}